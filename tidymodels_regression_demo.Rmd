---
title: "tidymodels_regression_demo"
author: "WY"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Introduction
```{r}
df_all_y <-
  read_csv(file='./input/train.csv',
           col_select = c(1,last_col() ),
           col_types=c('i','d'),
           n_max = 10) |>
  select(id, truth= `Premium Amount`)

df_sample <- read.csv('./input/sample_submission.csv')

```

# Regression Model improve step by step
## frame work
```{r}
library(yardstick)
rmsel <- function(data, truth, estimate,na_rm=TRUE){
  data|>
    select(truth={{truth}}, estimate={{estimate}})|>
    transmute(truth = log1p(truth),
              estimate = log1p(estimate) )|>
   rmse(truth, estimate) 
}

```

## models
### V0 init
```{r}
avg_value <- df_sample|>summarize(avg_value=mean(`Premium.Amount`))|>pull(avg_value)
df_init_v0 <- df_all_y |> mutate(estimate=avg_value)

df_init_v0 |> 
  rmsel('truth','estimate')
```

